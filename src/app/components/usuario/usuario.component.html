<link rel="stylesheet" href="../navbar-global.css" />
<nav class="navbar">
  <div class="navbar-container" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between;">
    <a href="/" class="navbar-logo" style="margin-left:0; text-align:left;">UAVDOCX</a>
    <div class="navbar-menu">
      <a href="/">Inicio</a>
      <a href="/productos">Productos</a>
      <a [routerLink]="usuarioLogueado ? '/usuario' : '/login'">Sesion</a>
      <div *ngIf="esAdminUsuario" class="dropdown">
        <a class="navbar-link dropdown-btn">Admin</a>
        <div class="dropdown-content">
          <a href="./usuarios">Usuarios</a>
          <a href="./reclamos">Reclamos</a>
          <a href="./abm">Prendas</a>
        </div>
      </div>
    </div>
    <div class="logos">
      <a href="/carrito" class="material-symbols-outlined">shopping_cart</a>
      <a href="/usuario" class="material-symbols-outlined">person</a>
      <a href="/reclamo" class="material-symbols-outlined">sentiment_extremely_dissatisfied</a>
      <a href="/local" class="material-symbols-outlined">store</a>
    </div>
  </div>
</nav>

<p>Inicio    -   Mi cuenta</p>

<div *ngIf="mensajeError" class="error">{{ mensajeError }}</div>


<div *ngIf="!logeado">
    <h1>Debe Iniciar Sesion</h1>
    <button (click)="redirigirLogin()">Ir a Iniciar Sesion</button>
</div>

<div class="info" *ngIf="logeado">
    <div>
        <h1>Mi cuenta</h1>
        <p>Datos Personales</p>
        <hr>
        <p>{{ nombre }}</p>
        <p>{{ email }}</p>
        <button (click)="cerrarSesion()">Cerrar Sesion</button>
    </div>
        <div>
        <h1>Compras</h1>
        <p>Compras realizadas por el usuario</p>
        <hr>
        <p *ngIf="compras.length === 0">No tienes compras. <a href="/carrito">Hacer una</a></p>
        <div *ngIf="compras.length > 0" class="carrusel">
            <button class="carrusel-arrow" (click)="compraIndex = (compraIndex - 1 + compras.length) % compras.length">&#8592;</button>
            <ul>
                <li *ngIf="compras[compraIndex]" class="reclamo-card">
                    <p>Fecha: {{ compras[compraIndex].fecha | date:'short' }}</p>
                    <p>Precio: {{ compras[compraIndex].precioTotal | currency:'ARS':'symbol':'1.2-2' }}</p>
                    <div>
                        <ul>
                            <li *ngFor="let producto of compras[compraIndex].productos">
                                {{ producto.nombre }}
                            </li>
                        </ul>
                    </div>
                    <p class="reclamo-estado">Estado: {{ compras[compraIndex].estado }}</p>
                    <button (click)="opinar(compras[compraIndex])">Dejar Opinion</button>
                </li>
            </ul>
            <button class="carrusel-arrow" (click)="compraIndex = (compraIndex + 1) % compras.length">&#8594;</button>
        </div>
     </div>
    <div>
        <h1>Reclamos</h1>
        <p>Reclamos realizados por el usuario</p>
        <hr>
        <div *ngIf="reclamos.length === 0">
            <p>No tienes reclamos. <a href="/reclamo">Hacer uno</a></p>
        </div>
        <div *ngIf="reclamos.length > 0" class="carrusel">
            <button class="carrusel-arrow" (click)="reclamoIndex = (reclamoIndex - 1 + reclamos.length) % reclamos.length">&#8592;</button>
            <ul>
                <li *ngIf="reclamos[reclamoIndex]" class="reclamo-card">
                    <p>{{ reclamos[reclamoIndex].tipo }}</p>
                    <p>{{ reclamos[reclamoIndex].descripcion }}</p>
                    <p class="reclamo-estado">Estado: {{ reclamos[reclamoIndex].estado }}</p>
                    <button (click)="eliminarReclamo(reclamos[reclamoIndex].id)">Eliminar Reclamo</button>
                </li>
            </ul>
            <button class="carrusel-arrow" (click)="reclamoIndex = (reclamoIndex + 1) % reclamos.length">&#8594;</button>
        </div>
    </div>

     <div>
       <h1>Opiniones</h1>
        <p>Opiniones realizadas por el usuario</p>
        <hr>
        <p *ngIf="opiniones.length === 0">No tienes opiniones.</p>
        <div *ngIf="opiniones.length > 0" class="carrusel">
            <button class="carrusel-arrow" (click)="opinionIndex = (opinionIndex - 1 + opiniones.length) % opiniones.length">&#8592;</button>
            <ul>
                <li *ngIf="opiniones[opinionIndex]" class="reclamo-card">
                    <div>
                        <ul>
                            <li *ngFor="let producto of compras[compraIndex].productos">
                                {{ producto.nombre }}
                            </li>
                        </ul>
                    </div>
                    <p>Calificaci√≥n: {{ opiniones[opinionIndex].calificacion }} / 5</p>
                    <p>Comentario: {{ opiniones[opinionIndex].comentario }}</p>
                    <button (click)="eliminarOpinion(opiniones[opinionIndex].id)" >Eliminar Opinion</button>
                </li>
            </ul>
            <button class="carrusel-arrow" (click)="opinionIndex = (opinionIndex + 1) % opiniones.length">&#8594;</button>
        </div>
     </div>
</div>
